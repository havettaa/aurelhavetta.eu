<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Vue</title>
  <base href="/vue/">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="/css/pico.css" rel="stylesheet" type="text/css" />
  <link href="/css/lit.css" rel="stylesheet" type="text/css" />

  <!-- <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->

  <script type="importmap">
    {
      "imports": {
        "app": "./appImports.js",
        "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
        "axios": "https://unpkg.com/axios/dist/axios.min.js"
      }
    }
  </script>
</head>
<body>
  <!-- Navbar -->
  <header hx-get="/lit/reuse/header.html" hx-trigger="load">
    <ins>=</ins>
  </header>
  <!-- End-Navbar -->



  <app-root></app-root>
  <mark>outside-ng: <div id="outside-ng" class="bg-gray-400"></div></mark>
  <script>
    setInterval(function() {
      window.document.title = `from javascript: ${new Date().toLocaleTimeString()}`;
      window.titulka = `from javascript: ${Date.now()}`;
      if (window.refstate?.value?.tile1)
      {
        window.refstate.value.tile1 = `from javascript: ${Math.random()}`;
        document.getElementById("outside-ng").innerHTML = window.refstate.value.tile1;
      }
    }, 100);
  </script>
  <script src="runtime.9804ec40e7f91a64.js" type="module"></script><script src="polyfills.e0f04cd57717fcf2.js" type="module"></script><script src="main.40251658dfb934d3.js" type="module"></script></body>



  <main id="app" data-accordion="collapse">
    <h2 id="accordion-collapse-heading-1">
      <button type="button" class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800" data-accordion-target="#accordion-collapse-body-1" aria-expanded="true" aria-controls="accordion-collapse-body-1">
        <span>VUE app lives here</span>
        <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
        </svg>
      </button>
    </h2>
    <div id="accordion-collapse-body-1" aria-labelledby="accordion-collapse-heading-1">
      <section class="p-5 border border-b-0 border-gray-200 dark:border-gray-700 dark:bg-gray-900">

        <!-- Nested accordion -->
        <div id="accordion-nested-collapse" data-accordion="collapse">
          <h2 id="accordion-nested-collapse-heading-1">
            <button type="button" class="flex items-center justify-between w-full p-5 rounded-t-xl font-medium text-left text-gray-500 border border-b-0 border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800" data-accordion-target="#accordion-nested-collapse-body-1" aria-expanded="false" aria-controls="accordion-nested-collapse-body-1">
              <span>{{ refstate.tile1 }}</span>
            <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
              </svg>
            </button>
          </h2>
          <div id="accordion-nested-collapse-body-1" aria-labelledby="accordion-nested-collapse-heading-1">
            <div class="p-5 border border-b-0 border-gray-200 dark:border-gray-700">
              <p class="text-gray-500 dark:text-gray-400">BTC Price is: <mark>{{ refstate.price }}</mark></p>
            </div>
          </div>
          <h2 id="accordion-nested-collapse-heading-2">
            <button type="button" class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-b-0 border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800" data-accordion-target="#accordion-nested-collapse-body-2" aria-expanded="false" aria-controls="accordion-nested-collapse-body-2">
              <span>{{ refstate.tile2 }}</span>
              <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
              </svg>
            </button>
          </h2>
          <div id="accordion-nested-collapse-body-2" aria-labelledby="accordion-nested-collapse-heading-2">
            <div class="p-5 border border-b-0 border-gray-200 dark:border-gray-700">
              <p class="text-gray-500 dark:text-gray-400">JS state: <mark>{{ localstate.price }}</mark></p>
            </div>
          </div>
        </div>
        <!-- End: Nested accordion -->

      </section>
    </div>
    <h2 id="accordion-collapse-heading-2">
      <button type="button" class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-500 border border-gray-200 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800" data-accordion-target="#accordion-collapse-body-2" aria-expanded="false" aria-controls="accordion-collapse-body-2">
        <span>Classic javascript</span>
        <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
        </svg>
      </button>
    </h2>
    <section id="accordion-collapse-body-2" aria-labelledby="accordion-collapse-heading-2">
      <div class="p-5 border border-gray-200 dark:border-gray-700">

        <h1>Count is: {{ count() }}</h1>
        <h1>Double is: {{ double() }}</h1>
        <h2>refcomputed is: {{ refcomputed }}</h2>
        <h3>domeleis: {{ domele() }}</h3>
        <button @click="count.update(v => v + 1)" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Increment</button>
        <button @click="count.set(0)" type="button" class="focus:outline-none text-white bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:focus:ring-yellow-900">Reset</button>

      </div>
    </section>
  </main>






  <section>
    <div class="border-b border-gray-200 dark:border-gray-700">
      <ul class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 dark:text-gray-400">
        <li class="mr-2">
            <a href="#" class="inline-flex items-center justify-center p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 group">
                <svg class="w-4 h-4 mr-2 text-gray-400 group-hover:text-gray-500 dark:text-gray-500 dark:group-hover:text-gray-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"/>
                </svg>Outside of Vue
            </a>
        </li>
      </ul>
    </div>

    <h1 id="domele" class="text-xl">value</h1>

  </section>

  <script setup type="module">
    import { createApp, ref, watchEffect, computed } from "vue"
    import { ngsignal, ngcomputed, ngref } from './angular-signal.js'

    const count = ngsignal(0);
    const double = ngcomputed(() => count() * 2);
    const domele = ngcomputed(() => {
      console.warn(`ngcomputed called ${count()}`);
      return count() / 2;
    });

    const localstate = { price: 0 };
    
    const refstate = ref({tile1: 'Here we have vue ref', tile2: 'Here no vue ref used',  price: 0})
    const refcomputed = computed(() => {
      console.error(`refcomputed called ${ngref.value}`);
      return ngref.value / 4;
    });
  
    watchEffect(() => {
      console.log(`ngcomputed called count() = ${count()} \n refstate = `);
      // Called every change for price
      document.querySelector("#domele").innerHTML = refstate.value.price;
      // console.table(refstate.value.price);
    });

    createApp({
      setup() {
        return {
          refstate, localstate, count, double, domele, refcomputed
        }
      }
    }).mount('#app')

    //////////////////////////////////////////////////////////////////////////////
    // Binance Web Socket
    const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${ ("BTC/USDT").toLowerCase().replace("/", "")}@trade`);
    ws.onmessage = function (event) {
      try {
        const btc = JSON.parse(event.data);
        const p = new Number(btc.p);
        localstate.price = p;
        refstate.value.price = p;
      }
      catch(e) {
        console.error(e?.message);
      }
    };
  </script>

  <script src="/js/htmx.js" crossorigin="anonymous"></script>
  <script src="/js/tailwind.js"></script>
  <!-- <script setup type="module" src="vueApp.js"></script> -->

  <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.css" rel="stylesheet" type="text/css" />

</body>
</html>
