GIPP={CONFIG:null},GIL={TEXT:null};var frameValidate=function(){return MapValidator.frameValidate()};MapValidator={overlap:function(e,t){for(var n=e.getGeometry().getCoordinates().flat(),a=t.getGeometry().getCoordinates().flat(),o=[],r=[],l=0;l<4;l++)o.push({X:n[l][0],Y:n[l][1]}),r.push({X:a[l][0],Y:a[l][1]});return!!this.isFrameIntersecting(o,r)||this.isFrameIntersecting(r,o)},isFrameIntersecting:function(e,t){for(var n=!1,a=null,o=null,r=null,l=null,i=null,c=null,m=(r=null,l=null,0);m<4&&!n;m++)for(var p=0;p<4;p++){var u=(p+1)%4,d=(u+1)%4;if(0==(o=e[p].Y-e[u].Y)&&(l=e[u].Y-t[m].Y,n=(r=e[u].Y-e[d].Y)>0&&l>=0||r<0&&l<0),0==(a=e[p].X-e[u].X))c=e[u].X-t[m].X,n=(i=e[u].X-e[d].X)>0&&c>=0||i<0&&c<0;else{var s=o/a,g=e[p].Y-s*e[p].X;l=s*t[m].X+g-t[m].Y,n=(r=s*e[d].X+g-e[d].Y)>0&&l>=0||r<0&&l<0}if(!n)break}return n},traceFeatures:function(e,t,n){for(var a=t[n].frameTrace,o=0;o<a.length;o++)-1==e.indexOf(a[o])&&(e.push(a[o]),e=this.traceFeatures(e,t,a[o]));return e},checkOverlap:function(){if(null==GIPP.CONFIG.checkOverlap||0==GIPP.CONFIG.checkOverlap)return!0;var e=frameSource.getFeatures(),t=e.length,n=[];if(1==t)return!0;for(var a=0;a<t;a++)n.push({frameIndex:a,frameTrace:[]});for(a=0;a<t;a++)for(var o=a+1;o<t;o++)this.overlap(e[a],e[o])&&(-1==n[a].frameTrace.indexOf(o)&&n[a].frameTrace.push(o),-1==n[a].frameTrace.indexOf(a)&&n[o].frameTrace.push(a));return this.traceFeatures([],n,0).length==n.length},checkMaxDistance:function(){if(null==GIPP.CONFIG.maxDistance||0==GIPP.CONFIG.maxDistance)return!0;for(var e=GIPP.CONFIG.maxDistance,t=frameSource.getFeatures(),n=t.length,a=mapOptions.centerTransform,o=null,r=0;r<n;r++)if(o=t[r].getProperties().center,Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2))>e)return!1;return!0},getCaptureCounts:function(){var e=captureSource.getFeatures(),t={},n=null;t.Sum=0;for(var a=0;a<e.length;a++)t[n=e[a].getGeometry().getType()]=null==t[n]?1:t[n]+1,t.Sum=t.Sum+1;return t},checkMaxGeometries:function(){if(!(null!=GIPP.CONFIG.maxGeometries&&0!=GIPP.CONFIG.maxGeometries||null!=GIPP.CONFIG.maxGeometriesPoint&&0!=GIPP.CONFIG.maxGeometriesPoint||null!=GIPP.CONFIG.maxGeometriesLine&&0!=GIPP.CONFIG.maxGeometriesLine||null!=GIPP.CONFIG.maxGeometriesPolygon&&0!=GIPP.CONFIG.maxGeometriesPolygon))return!0;var e=this.getCaptureCounts();return!(null!=GIPP.CONFIG.maxGeometries&&0!=GIPP.CONFIG.maxGeometries&&e.Sum>GIPP.CONFIG.maxGeometries||null!=GIPP.CONFIG.maxGeometriesPoint&&0!=GIPP.CONFIG.maxGeometriesPoint&&e.Point>GIPP.CONFIG.maxGeometriesPoint||null!=GIPP.CONFIG.maxGeometriesLine&&0!=GIPP.CONFIG.maxGeometriesLine&&e.LineString>GIPP.CONFIG.maxGeometriesLine||null!=GIPP.CONFIG.maxGeometriesPolygon&&0!=GIPP.CONFIG.maxGeometriesPolygon&&e.Polygon>GIPP.CONFIG.maxGeometriesPolygon)},getMBR:function(e){var t=e[0].getGeometry().getExtent()[0],n=e[0].getGeometry().getExtent()[1],a=e[0].getGeometry().getExtent()[0],o=e[0].getGeometry().getExtent()[1];return e.forEach((function(e){for(var r=e.getGeometry().getCoordinates().flat().flat(),l=1,i=0;i<8;i+=2)t>r[i]?t=r[i]:a<r[i]&&(a=r[i]),n<r[l]?n=r[l]:o>r[l]&&(o=r[l]),l+=2})),[t,o,a,n]},frameFeaturesArea:function(e,t){var n=performance.now(),a=frameSource.getFeatures(),o=a.length;if(0==o)return 0;var r=a[0].getGeometry().getCoordinates().flat(),l=r[0][1],i=r[1][0],c=r[1][1],m=r[2][0],p=r[3][1],u=Math.sqrt(Math.pow(r[0][0]-i,2)+Math.pow(l-c,2)),s=Math.sqrt(Math.pow(i-m,2)+Math.pow(c-p,2));if(e>=o*s*u)return 0;null==t&&(t=o<31?[5,o/2].sort()[1]:15);var g=1-t/200;dx=s*t/(400*g),dy=u*t/(400*g),d=[dy,dx].sort()[0],dd=d*d,d2=d/2;for(var f=this.getMBR(a),P=f[0]+d2,C=0;P<f[2];){for(var G=f[1]+d2;G<f[3];){for(var I=0;I<o;I++)if(a[I].getGeometry().intersectsCoordinate([P,G])){C++;break}G+=d}P+=d}var y=C*dd,v=performance.now();return console.log([y,o,t,(v-n)/1e3]),y},frameValidate:function(){var e="";if(!(frameCount>0))return decodeURI(GIL.TEXT.NoPlotCountMessage).split("+").join(" ");if(null==frameSource.getFeatures()[0].getProperties().center)return e;if(GIPP.CONFIG.maxMapSheet<frameCount)return decodeURI(GIL.TEXT.MaxPlotCountMessage).split("+").join(" ");this.checkMaxGeometries()||(e+=GIL.TEXT.MaxGeometriesMessage,e=null!=GIPP.CONFIG.maxGeometries&&0!=GIPP.CONFIG.maxGeometries?e.replace("{T}",GIPP.CONFIG.maxGeometries):e.replace(/ [^\s]+ - \{T\},*/,""),e=null!=GIPP.CONFIG.maxGeometriesPoint&&0!=GIPP.CONFIG.maxGeometriesPoint?e.replace("{P}",GIPP.CONFIG.maxGeometriesPoint):e.replace(/ [^\s]+ - \{P\},*/,""),e=null!=GIPP.CONFIG.maxGeometriesLine&&0!=GIPP.CONFIG.maxGeometriesLine?e.replace("{L}",GIPP.CONFIG.maxGeometriesLine):e.replace(/ [^\s]+ - \{L\},*/,""),e=(e=null!=GIPP.CONFIG.maxGeometriesPolygon&&0!=GIPP.CONFIG.maxGeometriesPolygon?e.replace("{Y}",GIPP.CONFIG.maxGeometriesPolygon):e.replace(/ [^\s]+ - \{Y\},*/,"")).replace(/\,$/,"")+"\n"),this.checkMaxDistance()||(e+=GIL.TEXT.MaxDistanceMessage.replace("{M}",GIPP.CONFIG.maxDistance)+"\n"),this.checkOverlap()||(e+=GIL.TEXT.OverlapMessage+"\n");var t=GIPP.CONFIG.maxShapeSize,n=this.frameFeaturesArea(t);return n>t&&(null==GIL.TEXT.MaxAreaMessage?e+="MaxAreaExceeded, current area: "+n+"\n":e+=GIL.TEXT.MaxAreaMessage.replace("{A}",Math.ceil(n)).replace("{A_C}",Math.ceil(t))+"\n"),e}};var _baseSite=function(){var e=window.location;return e.protocol+"//"+e.hostname},mapOptions=null,map=null,captureSource=null,frameSource=null,frameCount=0,allLayers={},captureLayer=null,frameLayer=null,initialize=function(e,t=!0,n=!1){captureSource=null,frameSource=null,frameCount=0,allLayers={},captureLayer=null,frameLayer=null,capture=null,selectCapture=null,selectFrames=null,translateCapture=null,modifyCapture=null,modifyFlag=!1,addPoint=!1,addLine=!1,addPolyLine=!1,addPolygon=!1,toggleLegend=!1,captureType=null,capturePointFeature=null,renderFlag=!1,faultyFeature=null,GIL.TEXT=e.MapText,1==t&&(mapOptions=e.MapOptions,GIPP.CONFIG=e.MapConfig,GIPP.CONFIG.gipmapServiceUrl=e.MapServicesUrl,GIPP.CONFIG.checkOverlap=Number(GIPP.CONFIG.checkOverlap),GIPP.CONFIG.mapLoadZoom=Number(GIPP.CONFIG.mapLoadZoom),GIPP.CONFIG.mapMinZoom=Number(GIPP.CONFIG.mapMinZoom),GIPP.CONFIG.maxDistance=Number(GIPP.CONFIG.maxDistance),GIPP.CONFIG.maxGeometries=Number(GIPP.CONFIG.maxGeometries),GIPP.CONFIG.maxGeometriesLine=Number(GIPP.CONFIG.maxGeometriesLine),GIPP.CONFIG.maxGeometriesPoint=Number(GIPP.CONFIG.maxGeometriesPoint),GIPP.CONFIG.maxGeometriesPolygon=Number(GIPP.CONFIG.maxGeometriesPolygon),GIPP.CONFIG.maxMapSheet=Number(GIPP.CONFIG.maxMapSheet),GIPP.CONFIG.maxShapeSize=Number(GIPP.CONFIG.maxShapeSize),$("#map").children().remove(),$("#legend").children().remove(),$("#legend").hide(),null==GIPP.CONFIG.gipmapServiceUrl||isEmpty(GIPP.CONFIG.gipmapServiceUrl)?console.log("gipmapServiceUrl is not defined"):(url=GIPP.CONFIG.gipmapServiceUrl+"geo/MapSource?role="+mapOptions.role,$.ajax({type:"GET",url:url,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},dataType:"json",success:function(e){initializeSources(e,n),renderSourcePanel(e)}})))},resetOptions=function(e){if($("#load").show(),$("#map").hide(),mapOptions=e,!renderFlag){setRenderFlag();var t=new ol.format.GeoJSON;null!=faultyFeature&&(captureSource.removeFeature(faultyFeature),faultyFeature=0);var n=captureSource.getFeatures(),a=t.writeFeatures(n);framesReload(a)}},framesCount=function(){if(null==frameSource)return 0;var e=frameSource.getFeatures();return null==e?0:e.length},isEmpty=function(e){return!(e=e.toString())||0===e.length||!e.trim()},initializeSources=function(e,t){var n=null;if(null==GIPP.CONFIG.projectionInitName||""==GIPP.CONFIG.projectionInitName)n=[mapOptions.x,mapOptions.y];else{var a=GIPP.CONFIG.projectionInitName;proj4.defs(a,GIPP.CONFIG.projectionInitDef),ol.proj.get(a),n=ol.proj.transform([mapOptions.x,mapOptions.y],GIPP.CONFIG.projectionInitName,GIPP.CONFIG.projectionDefault)}mapOptions.centerTransform=n;var o=null;isEmpty(GIPP.CONFIG.mapBoundminX)||isEmpty(GIPP.CONFIG.mapBoundminY)||isEmpty(GIPP.CONFIG.mapBoundmaxX)||isEmpty(GIPP.CONFIG.mapBoundmaxY)||(o=[GIPP.CONFIG.mapBoundminX,GIPP.CONFIG.mapBoundminY,GIPP.CONFIG.mapBoundmaxX,GIPP.CONFIG.mapBoundmaxY]);var r=GIPP.CONFIG.mapMinZoom,l=GIPP.CONFIG.mapLoadZoom;map=t?null==o?new ol.Map({layers:[],target:"map",controls:ol.control.defaults().extend([new ol.control.MousePosition({projection:GIPP.CONFIG.projectionDefault,coordinateFormat:function(e){return ol.coordinate.format(e,"{x}, {y}",2)}}),new ol.control.ZoomToExtent,new ol.control.Zoom,new ol.control.ZoomSlider]).extend([new toggleVisibleLegendCommand,new ol.control.ScaleLine({minWidth:120})]),view:new ol.View({center:n,zoom:17})}):new ol.Map({layers:[],target:"map",controls:ol.control.defaults().extend([new ol.control.MousePosition({projection:GIPP.CONFIG.projectionDefault,coordinateFormat:function(e){return ol.coordinate.format(e,"{x}, {y}",2)}}),new ol.control.ZoomToExtent,new ol.control.Zoom,new ol.control.ZoomSlider]).extend([new toggleVisibleLegendCommand,new ol.control.ScaleLine({minWidth:120})]),view:new ol.View({center:n,zoom:l,minZoom:r,extent:o})}):null==o?new ol.Map({layers:[],target:"map",controls:ol.control.defaults().extend([new ol.control.MousePosition({projection:GIPP.CONFIG.projectionDefault,coordinateFormat:function(e){return ol.coordinate.format(e,"{x}, {y}",2)}}),new ol.control.ZoomToExtent,new ol.control.Zoom,new ol.control.ZoomSlider]).extend([new toggleVisibleLegendCommand,new placementPointCommand,new placementLineCommand,new placementPolyLineCommand,new placementPolygonCommand,new editCommand,new editSwitchCommand,new ol.control.ScaleLine({minWidth:120})]),view:new ol.View({center:n,zoom:l})}):new ol.Map({layers:[],target:"map",controls:ol.control.defaults().extend([new ol.control.MousePosition({projection:GIPP.CONFIG.projectionDefault,coordinateFormat:function(e){return ol.coordinate.format(e,"{x}, {y}",2)}}),new ol.control.ZoomToExtent,new ol.control.Zoom,new ol.control.ZoomSlider]).extend([new toggleVisibleLegendCommand,new placementPointCommand,new placementLineCommand,new placementPolyLineCommand,new placementPolygonCommand,new editCommand,new editSwitchCommand,new ol.control.ScaleLine({minWidth:120})]),view:new ol.View({center:n,zoom:l,minZoom:r,extent:o})}),captureSource=new ol.source.Vector({wrapX:!1}),captureLayer=new ol.layer.Vector({source:captureSource,zIndex:90,visible:!0}),captureSource.on("addfeature",captureAfterChange),captureSource.on("changefeature",captureAfterChange),captureSource.on("removefeature",captureAfterChange);var i=new ol.format.GeoJSON;frameSource=new ol.source.Vector({format:i,zIndex:100}),frameLayer=new ol.layer.Vector({source:frameSource,visible:!0}),null!=e&&e.forEach((function(e){var t=null;if("OSM"==e.type){t=new ol.source.OSM({url:"//a.tile.openstreetmap.org/{z}/{x}/{y}.png",crossOrigin:null});var n=new ol.layer.Tile({source:t,visible:"1"==e.flagshow});t.on("tileloadend",(function(){$("#load").hide()})),map.addLayer(n),allLayers[e.source]=n}if("WMS"==e.type){var a=null;if(null!=e.crsid&&e.crsid!=GIPP.CONFIG.projectionDefault){var o=new ol.source.ImageWMS({url:e.url,params:{LAYERS:e.source,EXCEPTIONS:"XML",CRS:e.crsid},serverType:"geoserver",projection:ol.proj.get(e.crsid)});a=new ol.layer.Image({source:o,visible:"1"==e.flagshow}),o.on("imageloadend",(function(){$("#load").hide()}))}else o=new ol.source.ImageWMS({url:e.url,params:{LAYERS:e.source,EXCEPTIONS:"XML"},serverType:"geoserver"}),a=new ol.layer.Image({source:o,visible:"1"==e.flagshow}),o.on("imageloadend",(function(){$("#load").hide()}));map.addLayer(a),allLayers[e.source]=a,a.getSource().updateParams({UPDATESEQUENCE:+new Date/1e3})}})),map.addLayer(captureLayer),map.addLayer(frameLayer),map.on("click",mapClick),$("#gipmapp-command-edit-switch-element").addClass((function(){return"gipmapp-command-disabled"})),$("#gipmapp-command-edit-switch").prop("disabled",!0),$("#gipmapp-command-edit-switch").prop("title",GIL.TEXT.MapEditVerticesInact),$(".ol-scale-line").css("background","rgba(0,115,186,0.3)"),$(".ol-scale-line-inner").css("font-size","10px"),$(".ol-scale-line-inner").css("font-family","sans-serif"),$(".ol-scale-line-inner").css("border","1px solid white"),$(".ol-scale-line-inner").css("border-top","none"),t&&framesRead()},framesReload=function(e){var t=GIPP.CONFIG.epServicesUrl;t=0==t.indexOf("http://")||0==t.indexOf("https://")?GIPP.CONFIG.epServicesUrl+"/api/plotboxcollection/calculate?crsid="+GIPP.CONFIG.projectionDefault+"&pw="+mapOptions.pageWidth+"&ph="+mapOptions.pageHeight:_baseSite()+GIPP.CONFIG.epServicesUrl+"/api/plotboxcollection/calculate?crsid="+GIPP.CONFIG.projectionDefault+"&pw="+mapOptions.pageWidth+"&ph="+mapOptions.pageHeight,$.ajax({type:"POST",url:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},data:e,dataType:"json",success:function(e){var t=(new ol.format.GeoJSON).readFeatures(e);frameCount=t.length,frameSource.clear(!0),frameSource.addFeatures(t),$("#load").hide(),$("#map").show()}})},frames=function(){var e=new ol.Collection;if(null==captureSource)return null;captureSource.forEachFeature((function(e){e.set("capture","true")}));var t=captureSource.getFeatures(),n=frameSource.getFeatures();e.extend(t),e.extend(n);var a=(new ol.format.GeoJSON).writeFeatures(e.getArray());return JSON.parse(a)},framesRead=function(e){if(null!=GIPP.CONFIG.gipmapServiceUrl&&!isEmpty(GIPP.CONFIG.gipmapServiceUrl)){if(url=GIPP.CONFIG.gipmapServiceUrl+"geo/framedataread?requestid="+mapOptions.parent_fid+"&crsid="+GIPP.CONFIG.projectionDefault,null==GIPP.CONFIG.projectionDefault||""==GIPP.CONFIG.projectionDefault||null==mapOptions.parent_fid||null==mapOptions.parent_fid)return null;$.ajax({type:"POST",url:url,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},data:e,dataType:"json",success:function(e){if(null!=e&&0!=e.length){var t=(new ol.format.GeoJSON).readFeatures(e);frameCount=t.length,frameSource.clear(!0),frameSource.addFeatures(t)}}})}},capture=null,selectCapture=null,selectFrames=null,translateCapture=null,modifyCapture=null,modifyFlag=!1,addPoint=!1,addLine=!1,addPolyLine=!1,addPolygon=!1,toggleLegend=!1,captureType=null,capturePointFeature=null,renderFlag=!1,toggleVisible=function(e){var t=allLayers[e];if(null!=t){var n=t.getVisible();t.setVisible(!n)}},renderSourcePanel=function(e){null!=e&&e.forEach((function(e){var t="<div><input type='checkbox' id='viewVisible"+e.source_id+"' "+("1"==e.flagshow?"checked='checked'":"")+"><span class='ig-label-span'>"+e.descript+"</span></div>";$("#legend").append(t),$(document).on("change","#viewVisible"+e.source_id,(function(){toggleVisible(e.source)}))}))},clearSwitchHandler=function(){return null==selectCapture?null:null==modifyCapture&&null==translateCapture?null:void(modifyFlag&&(map.removeInteraction(modifyCapture),modifyCapture=null,translateCapture=new ol.interaction.Translate({features:selectCapture.getFeatures()}),map.addInteraction(translateCapture),translateCapture.on("translateend",captureBeforeChange),$("#gipmapp-command-edit-switch-element").removeClass((function(){return"gipmapp-command-active"})),modifyFlag=!1))},clearInteraction=function(){clearSwitchHandler(),null!=capture&&map.removeInteraction(capture),null!=selectCapture&&map.removeInteraction(selectCapture),null!=modifyCapture&&map.removeInteraction(modifyCapture),null!=translateCapture&&map.removeInteraction(translateCapture),null!=selectFrames&&map.removeInteraction(selectFrames),capture=null,selectCapture=null,modifyCapture=null,translateCapture=null,selectFrames=null,$("#gipmapp-command-polygon-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-legend-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-point-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-polyline-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-line-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-edit-switch-element").addClass((function(){return"gipmapp-command-disabled"})),$("#gipmapp-command-edit-switch").prop("disabled",!0),$("#gipmapp-command-edit-switch").prop("title",GIL.TEXT.MapEditVerticesInact)},addCapture=function(e){"None"!==e&&(capture=new ol.interaction.Draw({source:captureSource,type:e}),map.addInteraction(capture),capture.on("drawstart ",captureStartNewFeature),capture.on("drawend",captureBeforeNewFeature))},renderInterval=null,clearRenderFlag=function(){renderFlag=!1,null!=renderInterval&&(clearInterval(renderInterval),renderInterval=null)},setRenderFlag=function(){renderFlag=!0,null==renderInterval&&(renderInterval=setInterval(clearRenderFlag,500))},mapClick=function(e){"Line"!=captureType&&"Point"!=captureType||null==capture||capture.a.length>2&&capture.finishDrawing()},captureStartNewFeature=function(e){},faultyFeature=null,captureBeforeNewFeature=function(e){if("Point"==captureType&&null!=capture&&(capturePointFeature=e.feature),"Line"==captureType&&null!=capture){var t=e.feature.getGeometry(),n=t.getFirstCoordinate(),a=t.getLastCoordinate();n[0]==a[0]&&n[1]==a[1]&&(faultyFeature=e.feature)}e.feature.set("scale",mapOptions.scale),e.feature.set("overlapHorizontalMM",mapOptions.pageOverlap),e.feature.set("overlapVerticalMM",mapOptions.pageOverlap)},captureBeforeChange=function(e){},captureAfterChange=function(e){if(!renderFlag){setRenderFlag();var t=new ol.format.GeoJSON;null!=faultyFeature&&(captureSource.removeFeature(faultyFeature),faultyFeature=0);var n=captureSource.getFeatures(),a=t.writeFeatures(n);framesReload(a)}},deleteFeature=function(e){if(46==e.keyCode&&null!=translateCapture&&null!=selectCapture){map.removeInteraction(translateCapture);for(var t=selectCapture.getFeatures().getArray(),n=0;n<t.length&&n<10;n++)captureSource.removeFeature(t[n]);selectCapture.getFeatures().clear()}};document.addEventListener("keydown",deleteFeature,!1);var toggleVisibleLegendCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapOpenLegend,a="gipmapp-command-legend",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.toggleVisibleLegendHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.toggleVisibleLegendHandler=function(){$("#legend").toggle(),clearInteraction(),toggleLegend?($("#gipmapp-command-legend-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-legend").blur(),toggleLegend=!1):($("#gipmapp-command-legend-element").addClass((function(){return"gipmapp-command-active"})),toggleLegend=!0,addPoint=!1,addLine=!1,addPolyLine=!1,addPolygon=!1)},e}(),placementPointCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapPlacePoint,a="gipmapp-command-point",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.placementPointHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.placementPointHandler=function(){clearInteraction(),$("#legend").hide(),addPoint?($("#gipmapp-command-point-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-point").blur(),addPoint=!1):($("#gipmapp-command-point-element").addClass((function(){return"gipmapp-command-active"})),captureType="Point",addCapture("Point"),addPoint=!0,addLine=!1,addPolyLine=!1,addPolygon=!1,toggleLegend=!1)},e}(),placementLineCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapPlaceLine,a="gipmapp-command-line",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.placementLineHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.placementLineHandler=function(){clearInteraction(),$("#legend").hide(),addLine?($("#gipmapp-command-line-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-line").blur(),addLine=!1):($("#gipmapp-command-line-element").addClass((function(){return"gipmapp-command-active"})),captureType="Line",addCapture("LineString"),addLine=!0,addPoint=!1,addPolyLine=!1,addPolygon=!1,toggleLegend=!1)},e}(),placementPolyLineCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapPlacePolyline,a="gipmapp-command-polyline",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.placementPolyLineHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.placementPolyLineHandler=function(){clearInteraction(),$("#legend").hide(),addPolyLine?($("#gipmapp-command-polyline-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-polyline").blur(),addPolyLine=!1):($("#gipmapp-command-polyline-element").addClass((function(){return"gipmapp-command-active"})),captureType="LineString",addCapture("LineString"),addPolyLine=!0,addPoint=!1,addLine=!1,addPolygon=!1,toggleLegend=!1)},e}(),placementPolygonCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapPlacePolygon,a="gipmapp-command-polygon",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.placementPolygonHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.placementPolygonHandler=function(){clearInteraction(),$("#legend").hide(),addPolygon?($("#gipmapp-command-polygon-element").removeClass((function(){return"gipmapp-command-active"})),$("#gipmapp-command-polygon").blur(),addPolygon=!1):($("#gipmapp-command-polygon-element").addClass((function(){return"gipmapp-command-active"})),captureType="Polygon",addCapture("Polygon"),addPolygon=!0,addPoint=!1,addLine=!1,addPolyLine=!1,toggleLegend=!1)},e}(),editCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapEditMode,a="gipmapp-command-edit",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.editHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.editHandler=function(){clearInteraction(),$("#legend").hide(),selectCapture=new ol.interaction.Select({layers:[captureLayer]}),map.addInteraction(selectCapture),selectCapture.on("select",(function(e){null!=modifyCapture&&map.removeInteraction(modifyCapture),null!=translateCapture&&map.removeInteraction(translateCapture),modifyFlag?(modifyCapture=new ol.interaction.Modify({features:selectCapture.getFeatures()}),map.addInteraction(modifyCapture),modifyCapture.on("modifyend",captureBeforeChange)):(translateCapture=new ol.interaction.Translate({features:selectCapture.getFeatures()}),$("#gipmapp-command-edit-switch-element").removeClass((function(){return"gipmapp-command-disabled"})),$("#gipmapp-command-edit-switch").prop("disabled",!1),$("#gipmapp-command-edit-switch").prop("title",GIL.TEXT.MapEditVertices),addPoint=!1,addLine=!1,addPolyLine=!1,addPolygon=!1,toggleLegend=!1,map.addInteraction(translateCapture),translateCapture.on("translateend",captureBeforeChange))}))},e}(),editSwitchCommand=function(){function e(e){var t=e||{},n=GIL.TEXT.MapEditVertices,a="gipmapp-command-edit-switch",o=document.createElement("button");o.id=a,o.title=n;var r=document.createElement("div");r.id=a+"-element",r.className=a+" ol-selectable ol-control",r.appendChild(o),ol.control.Control.call(this,{element:r,target:t.target}),o.addEventListener("click",this.editSwitchHandler.bind(this),!1)}return ol.control.Control&&(e.__proto__=ol.control.Control),(e.prototype=Object.create(ol.control.Control&&ol.control.Control.prototype)).constructor=e,e.prototype.editSwitchHandler=function(){return $("#legend").hide(),null==selectCapture?null:null==modifyCapture&&null==translateCapture?null:void(modifyFlag?(map.removeInteraction(modifyCapture),modifyCapture=null,translateCapture=new ol.interaction.Translate({features:selectCapture.getFeatures()}),map.addInteraction(translateCapture),translateCapture.on("translateend",captureBeforeChange),$("#gipmapp-command-edit-switch-element").removeClass((function(){return"gipmapp-command-active"})),modifyFlag=!1):(map.removeInteraction(translateCapture),translateCapture=null,modifyCapture=new ol.interaction.Modify({features:selectCapture.getFeatures()}),map.addInteraction(modifyCapture),modifyCapture.on("modifyend",captureBeforeChange),$("#gipmapp-command-edit-switch-element").addClass((function(){return"gipmapp-command-active"})),modifyFlag=!0))},e}();